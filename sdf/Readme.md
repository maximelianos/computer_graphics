# SDF render
<img src=pictures/fractal0.png width=400>

Signed Distance Field is minimal distance from a point to a shape. It allows efficient compression of fonts and binary images, and also allows interesting blending of shapes.

## Features
* Draw analytical shapes: circle, rectangle, triangle, line segment
* Scaling, rotation, translation of shapes
* Smooth transition between shapes, smooth mixing of color
* Load an SDF matrix from file
* Color gradient
* Draw border around shapes, antialiasing
* Compute SDF from binary images

## Implementation
Written from scratch in Rust. Implements basic 2D geometry: 
* Point struct (which serves as a vector), implemented dot product, cross product, projection of one vector onto another, rotation
* Shape struct for all shapes - both analytical, loaded SDF from PNG or computed from binary image via BFS graph algorithm
* ShapeTransform struct, applies scaling, rotation, translation (in this order). ShapeTransform::apply actually computes inverse transform to go from desired point to local shape space. Scaling is also applied to SDF values
* ShapeType denotes analytical shapes (circle, rectangle) or bitmap - SDF loaded from PNG file or computed from binary image

Color blending is implemented to mix any number of shapes. The algorithm is:
* Compute minimum D(istance)_0, identify shapes with similar D's which are less than D_0 + eps. Other shapes that are far away are ignored
* Weight colors using D_0 + eps - D
* Sum up weights, divide them by sum

Computation of SDF from binary image is done intuitively with BFS graph algorithm:
* Mark inside as visited, propagate outside
* Mark outside as visited, propagate inside
The result clearly is not true SDF, but it's close. At each point, take a 5x5 neighbourhood (3x3 was inaccurate), look at closest points to those and choose smallest distance.

## Files
* Rust sources are src/main.rs and src/loadsdf.rs
* Cargo.toml - dependecies
* resources/ - SDF and images in png format

## Compile and run
Project was developed on Ubuntu OS, using Rust compiler rustc 1.67.1. Compile and run:
```
cargo build --release && ./target/release/sdf
```
Cargo should install Rust dependencies. Rendered images will be saved to working directory. Implemented scenes:
* Shapes with smooth border and color transition
* Scene with all kinds of objects
* Bird: binary image is loaded from file, then SDF is computed
* Fox: simple shapes, including line segments
* Letters: loading SDF saved to png files, generated by [msdfgen](https://github.com/Chlumsky/msdfgen)
* Flame: compute SDF from binary image at high resolution, then store SDF in small resolution. Use gradient color
* Art: random shapes

Output image dimensions are 1600x1600 pixels.

Msdfgen was installed with its dependencies. To generate PNG of SDF for a font letter: `./msdfgen sdf -font /usr/share/fonts/truetype/liberation/LiberationSans-Regular.ttf 77 -o $HOME/sdf/out.png -range 10 -translate 5 5 -size 64 64 -autoframe -testrender $HOME/sdf/test.png 1024 1024`

## References

* Learn Rust: https://doc.rust-lang.org/rust-by-example/hello/print.html
* Image library: https://docs.rs/image/0.24.5/image/
* Lib dependecies: https://doc.rust-lang.org/rust-by-example/cargo/deps.html
* Define + for struct: https://doc.rust-lang.org/rust-by-example/trait/ops.html
* Implement default for struct: https://doc.rust-lang.org/std/default/trait.Default.html
* Dynamic vectors: https://stevedonovan.github.io/rust-gentle-intro/1-basics.html
* Official docs on vectors: https://doc.rust-lang.org/std/vec/struct.Vec.html
* Why no default params in funcs: https://www.thecodedmessage.com/posts/default-params/
* Sorting by key: https://docs.rs/radsort/latest/radsort/index.html
* Color picker: https://www.w3schools.com/colors/colors_picker.asp
* Color palette: https://coolors.co/palette/8ecae6-219ebc-023047-ffb703-fb8500
